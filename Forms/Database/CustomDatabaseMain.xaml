<UserControl x:Class="Incubator_2.Forms.Database.CustomDatabaseMain"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Incubator_2.Forms.Database" xmlns:oneinstance="clr-namespace:Incubator_2.Forms.OneInstance" xmlns:fa="http://schemas.fontawesome.io/icons/"
             mc:Ignorable="d" 
             d:DesignHeight="650" d:DesignWidth="1200" Cursor="">
    <GroupBox Style="{DynamicResource MainGroupBox}" Header="БАЗЫ ДАННЫХ">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="162*"/>
                <RowDefinition Height="40"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240" MinWidth="100" MaxWidth="400"/>
                <ColumnDefinition Width="272*"/>
                <ColumnDefinition Width="260" MinWidth="100" MaxWidth="400"/>
            </Grid.ColumnDefinitions>
            <ScrollViewer VerticalScrollBarVisibility="Auto" Grid.RowSpan="3">
                <StackPanel >
                    <Expander Style="{DynamicResource ExpanderMain}" Header="Базы данных" IsExpanded="True">
                        <StackPanel>
                            <Button x:Name="btnNewDatabase" Style="{DynamicResource ButtonFlat}" Visibility="{Binding CreateCommandVisibility}" Click="NewDatabase">
                                <StackPanel Orientation="Horizontal">
                                    <Path RenderOptions.EdgeMode="Aliased" Data="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" Fill="{Binding ElementName=btnNewDatabase, Path=Foreground}" VerticalAlignment="Center"/>
                                    <Label Foreground="{Binding ElementName=btnNewDatabase, Path=Foreground}" Content="Добавить базу данных"/>
                                </StackPanel>
                            </Button>
                            <ListBox x:Name="DatabasesList"
                                Style="{DynamicResource ListBoxMain}"
                                ItemContainerStyle="{DynamicResource ListBoxItemPurple}"
                                ItemsSource="{Binding Databases}" SelectedItem="{Binding SelectedDatabase}" DisplayMemberPath="name" Background="{x:Null}" Grid.RowSpan="2" Margin="0,-2,0,-2" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Удалить выбранную базу данных" Visibility="{Binding CreateCommandVisibility}"/>
                                        <MenuItem Header="Редактировать выбранную базу данных" Visibility="{Binding CreateCommandVisibility}"/>
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                            </ListBox>
                        </StackPanel>
                    </Expander>
                    <Expander Style="{DynamicResource ExpanderMain}" Header="Таблицы" IsExpanded="True" Visibility="{Binding TablesVisibility}">
                        <StackPanel>
                            <Button x:Name="btnNewTable" Style="{DynamicResource ButtonFlat}" Visibility="{Binding CreateCommandVisibility}" Click="NewTable">
                                <StackPanel Orientation="Horizontal">
                                    <Path RenderOptions.EdgeMode="Aliased" Data="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" Fill="{Binding ElementName=btnNewTable, Path=Foreground}" VerticalAlignment="Center"/>
                                    <Label Foreground="{Binding ElementName=btnNewTable, Path=Foreground}" Content="Добавить таблицу"/>
                                </StackPanel>
                            </Button>
                            <ListBox x:Name="TablesList" 
                                Style="{DynamicResource ListBoxMain}"
                                ItemContainerStyle="{DynamicResource ListBoxItemMicro}"
                                ItemsSource="{Binding Tables}" SelectedItem="{Binding SelectedTable}" Background="{x:Null}" Grid.RowSpan="2" Margin="0,-2,0,-2" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Удалить выбранную таблицу" Visibility="{Binding CreateCommandVisibility}"/>
                                        <MenuItem Header="Редактировать выбранную таблицу" Visibility="{Binding CreateCommandVisibility}"/>
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                            </ListBox>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>
            <Grid Grid.Column="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition MaxWidth="300"/>
                </Grid.ColumnDefinitions>
                <TextBox Style="{DynamicResource TextBoxMain}" Tag="Поиск по указанному полю" Text="{Binding SearchText}" TextChanged="SearchTextChanged" Margin="40,5,5,5" Cursor="IBeam">
                    <TextBox.ContextMenu>
                        <ContextMenu>

                        </ContextMenu>
                    </TextBox.ContextMenu>
                </TextBox>
                <ComboBox Style="{DynamicResource ComboBoxMain}" ItemsSource="{Binding Columns}" SelectedItem="{Binding ColumnFilter}" Cursor="Hand" Grid.Column="1" Margin="5,5,40,5"/>
                
                <fa:FontAwesome Icon="Search" Style="{DynamicResource IconButton}" MouseDown="SearchClick" HorizontalAlignment="Left"/>
                <fa:FontAwesome Icon="Remove" Style="{DynamicResource IconButton}" MouseDown="ClearCustomClick" HorizontalAlignment="Right" Grid.Column="1"/>
            </Grid>
            <GridSplitter Grid.RowSpan="3" Grid.Column="1" HorizontalAlignment="Left"/>
            <DataGrid x:Name="TableGrid" Style="{DynamicResource DataGridMain}" Grid.Column="1" ItemsSource="{Binding Table}" IsTextSearchEnabled="True" IsTextSearchCaseSensitive="False" TextSearch.TextPath="id" TextSearch.Text="11" Margin="5,5,5,5" IsReadOnly="True" SelectionUnit="{Binding SelectionUnit}" Grid.Row="1">
            </DataGrid>
            <Border Grid.Row="2" Grid.Column="1" Background="{DynamicResource Black}" CornerRadius="5" Margin="6,0,6,0" Grid.ColumnSpan="2">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <fa:FontAwesome Style="{DynamicResource IconButton}" Icon="Plus" ToolTip="Добавить запись" MouseDown="AddNewRecordClick" IsEnabled="{Binding CanUserEditTable}"/>
                    <fa:FontAwesome Style="{DynamicResource IconButton}" Icon="Clipboard" ToolTip="Добавить запись копированием текущей" MouseDown="CopyRecordClick" IsEnabled="{Binding CanUserEditTable}" Visibility="{Binding EditingVisibility}"/>
                    <Rectangle Fill="{DynamicResource Element}" Width="1" Margin="0,3,0,3" Visibility="{Binding EditingVisibility}" />
                    <fa:FontAwesome Style="{DynamicResource IconButton}" Icon="Pencil" ToolTip="Редактировать выбранную запись" MouseDown="EditRecordClick" Visibility="{Binding EditingVisibility}" IsEnabled="{Binding CanUserEditTable}"/>
                    <fa:FontAwesome Style="{DynamicResource IconButton}" Icon="Remove" ToolTip="Удалить выбранные записи" MouseDown="DeleteRecordsClick" Visibility="{Binding EditingVisibility}" IsEnabled="{Binding CanUserEditTable}"/>
                    <Rectangle Fill="{DynamicResource Element}" Width="1" Margin="0,3,0,3" Cursor="" />
                    <fa:FontAwesome Style="{DynamicResource IconButton}" Icon="MousePointer" ToolTip="Переключить тип выбора ячеек (целиком строка или отдельная ячейка)" MouseDown="SwitchSelectionUnitClick"/>
                    <fa:FontAwesome Style="{DynamicResource IconButton}" Icon="Refresh" ToolTip="Обновить записи" MouseDown="RefreshClick"/>
                </StackPanel>
            </Border>
            <GridSplitter Grid.Column="1" Grid.RowSpan="2" />
            <Border Grid.Column="2" Background="{DynamicResource Black}" CornerRadius="2" Margin="0,5,5,5" BorderThickness="2" BorderBrush="{DynamicResource Element}" Grid.RowSpan="2">
                <StackPanel>
                    <Button x:Name="btnNewCommand" Style="{DynamicResource ButtonFlat}" Visibility="{Binding CreateCommandVisibility}" Click="NewCommandClick">
                        <StackPanel Orientation="Horizontal">
                            <Path RenderOptions.EdgeMode="Aliased" Data="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" Fill="{Binding ElementName=btnNewCommand, Path=Foreground}" VerticalAlignment="Center"/>
                            <Label Foreground="{Binding ElementName=btnNewCommand, Path=Foreground}" Content="Добавить команду"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="btnNewTemplate" Style="{DynamicResource ButtonFlat}" Click="NewTemplateClick">
                        <StackPanel Orientation="Horizontal">
                            <Path RenderOptions.EdgeMode="Aliased" Data="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" Fill="{Binding ElementName=btnNewTemplate, Path=Foreground}" VerticalAlignment="Center"/>
                            <Label Foreground="{Binding ElementName=btnNewTemplate, Path=Foreground}" Content="Создать шаблон"/>
                        </StackPanel>
                    </Button>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Path Fill="{DynamicResource Success}" Data="M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1zm4 3.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Label Content="Чтение:" Foreground="{DynamicResource GrayLight}" Grid.Column="1"/>
                    </Grid>

                    <ItemsControl ItemsSource="{Binding ReadCommands}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <MenuItem Header="{Binding name}" Tag="{Binding query}" ToolTip="Выполнить команду для показа списка в другом виде" Click="ReadCommandClick">
                                    <MenuItem.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Редактировать команду" Visibility="{Binding CreateCommandVisibility}" Tag="{Binding id}" ToolTipService.IsEnabled="False" Click="EditCommand"/>
                                            <MenuItem Header="Удалить команду" Visibility="{Binding CreateCommandVisibility}" Tag="{Binding id}" ToolTipService.IsEnabled="False" Click="RemoveCommand"/>
                                        </ContextMenu>
                                    </MenuItem.ContextMenu>
                                </MenuItem>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Rectangle Fill="{DynamicResource LightBlack}" Height="1"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Path Fill="{DynamicResource DarkYellow}" Data="M2.114 8.063V7.9c1.005-.102 1.497-.615 1.497-1.6V4.503c0-1.094.39-1.538 1.354-1.538h.273V2h-.376C3.25 2 2.49 2.759 2.49 4.352v1.524c0 1.094-.376 1.456-1.49 1.456v1.299c1.114 0 1.49.362 1.49 1.456v1.524c0 1.593.759 2.352 2.372 2.352h.376v-.964h-.273c-.964 0-1.354-.444-1.354-1.538V9.663c0-.984-.492-1.497-1.497-1.6M13.886 7.9v.163c-1.005.103-1.497.616-1.497 1.6v1.798c0 1.094-.39 1.538-1.354 1.538h-.273v.964h.376c1.613 0 2.372-.759 2.372-2.352v-1.524c0-1.094.376-1.456 1.49-1.456V7.332c-1.114 0-1.49-.362-1.49-1.456V4.352C13.51 2.759 12.75 2 11.138 2h-.376v.964h.273c.964 0 1.354.444 1.354 1.538V6.3c0 .984.492 1.497 1.497 1.6" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Label Content="Изменение:" Foreground="{DynamicResource GrayLight}" Grid.Column="1"/>
                    </Grid>
                    <ItemsControl ItemsSource="{Binding UpdateCommands}" IsEnabled="{Binding EditingEnabled}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <MenuItem Header="{Binding name}" Tag="{Binding query}" ToolTip="Выполнить команду для изменения данных" Click="UpdateCommandClick">
                                    <MenuItem.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Редактировать команду" Visibility="{Binding CreateCommandVisibility}" Tag="{Binding id}" ToolTipService.IsEnabled="False" Click="EditCommand"/>
                                            <MenuItem Header="Удалить команду" Visibility="{Binding CreateCommandVisibility}" Tag="{Binding id}" ToolTipService.IsEnabled="False" Click="RemoveCommand"/>
                                        </ContextMenu>
                                    </MenuItem.ContextMenu>
                                </MenuItem>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Rectangle Fill="{DynamicResource LightBlack}" Height="1" Visibility="{Binding CreateCommandVisibility}"/>
                    <Grid Visibility="{Binding CreateCommandVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Path Fill="{DynamicResource PrimaryMain}" Data="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        
                        <Label Content="Импорт:" Foreground="{DynamicResource GrayLight}" Grid.Column="1"/>
                    </Grid>
                    <MenuItem Header="Импорт из Excel (добавление)" Tag="Import" Click="ImportClick" Visibility="{Binding CreateCommandVisibility}"/>
                    <MenuItem Header="Импорт из Excel (с заменой)" Tag="FullImport" Click="ImportClick" Visibility="{Binding CreateCommandVisibility}"/>
                    <Rectangle Fill="{DynamicResource LightBlack}" Height="1"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Path Fill="{DynamicResource LightPurple}" Data="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Label Content="Экспорт:" Foreground="{DynamicResource GrayLight}" Grid.Column="1"/>
                    </Grid>
                    <MenuItem Header="Экспорт в Excel" Tag="Excel" Click="ExportClick"/>
                    <MenuItem Header="Экспорт в Word" Tag="Word" IsEnabled="False" Click="ExportClick"/>
                    <Rectangle Fill="{DynamicResource Element}" Height="1" Visibility="Collapsed"/>
                    <Grid Visibility="Collapsed">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Path Fill="{DynamicResource LightPurple}" Data="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Label Content="Создать документы:" Foreground="{DynamicResource GrayLight}" Grid.Column="1"/>
                    </Grid>
                    
                </StackPanel>
            </Border>
        </Grid>
    </GroupBox>
</UserControl>
